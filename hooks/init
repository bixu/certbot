#!{{pkgPathFor "core/bash"}}/bin/bash

exec 2>&1

get_certificate() {
  echo "$(date) Getting any needed LetsEncrypt certificates for '$domain'"
  certbot certonly \
    --{{cfg.plugin}} \
    --config='{{pkg.svc_config_path}}/{{pkg.name}}.ini' \
    --domain=$domain \
    --noninteractive
}

{{#each cfg.domains as |domain| ~}}
export domain={{domain.name}}
get_certificate
{{/each ~}}
